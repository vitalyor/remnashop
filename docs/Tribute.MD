# API документация

## Авторизация

Для доступа к API Tribute необходимо получить API-ключ через панель автора.

### Как получить API-ключ

1. **Откройте Панель Автора**: Перейдите в свою панель автора Tribute
2. **Перейдите в Настройки**: Нажмите на три точки (⋯) в меню
3. **Откройте раздел API-ключи**: Выберите пункт "API Keys" в меню настроек
4. **Создайте новый ключ**: Нажмите кнопку "Generate API Key"
5. **Скопируйте и сохраните**: Скопируйте сгенерированный ключ и сохраните его в безопасном месте

### Использование API-ключа

API-ключ передаётся в заголовке `Api-Key` в каждом HTTPS-запросе к API.

#### Пример с использованием curl:

```bash
curl -X GET \
  'https://tribute.tg/api/v1/products' \
  -H 'Api-Key: your_api_key_here'
```

---

# Интеграция Tribute в Remnashop (как сейчас реализовано)

В этом репозитории Tribute добавлен как платёжный шлюз `TRIBUTE` и работает через webhook.

## Что нужно настроить в админке Remnashop → Gateways → TRIBUTE

- `api_key` — ключ Tribute (используется для проверки подписи webhook).
- `plan_id` — ID тарифа в Remnashop, который будет выдаваться/продлеваться после оплаты через Tribute.
- `subscription_link` **или** `donate_link` — ссылка Tribute.
  - Если указан `subscription_link`, бот не передаёт сумму в URL (периоды/цены задаются на стороне Tribute).
  - Если указан только `donate_link`, бот передаёт `amount` (в копейках) как параметр URL.
- `period_map_json` — JSON-объект для маппинга периода Tribute → длительность подписки в днях.
  - Обязателен, если используешь `subscription_link`.

## Формат `period_map_json`

Это JSON-объект вида `"ключ": дни`. Есть два режима:

1) Обычный (legacy): ключи без двоеточия

```json
{
  "1": 30,
  "3": 90
}
```

2) Строгий (рекомендуемый, “защита от дурака”): ключи с префиксом

```json
{
  "period_id:1": 30,
  "period_id:3": 90,
  "amount:25000": 30
}
```

В строгом режиме бот подставляет в поиск ключи вроде `period_id:<...>` / `period_name:<...>` / `amount:<...>`
в зависимости от того, какие поля реально пришли в webhook.

## Webhook

Сейчас ожидается подпись в заголовке `trbt-signature`:

- подпись = `HMAC_SHA256(api_key, raw_body)` в hex
- тело берётся “как есть” (raw bytes), затем декодируется в UTF-8 для расчёта

После успешного webhook бот создаёт/обновляет транзакцию (idempotent по `order_id/payment_id/...`) и запускает
стандартный пайплайн выдачи/продления подписки.

# API документация

## Авторизация

Для доступа к API Tribute необходимо получить API-ключ через панель автора.

### Как получить API-ключ

1. **Откройте Панель Автора**: Перейдите в свою панель автора Tribute
2. **Перейдите в Настройки**: Нажмите на три точки (⋯) в меню
3. **Откройте раздел API-ключи**: Выберите пункт "API Keys" в меню настроек
4. **Создайте новый ключ**: Нажмите кнопку "Generate API Key"
5. **Скопируйте и сохраните**: Скопируйте сгенерированный ключ и сохраните его в безопасном месте

### Использование API-ключа

API-ключ передаётся в заголовке `Api-Key` в каждом HTTPS-запросе к API.

#### Пример с использованием curl:

```bash
curl -X GET \
  'https://tribute.tg/api/v1/products' \
  -H 'Api-Key: your_api_key_here'
```

# API документация

## Авторизация

Для доступа к API Tribute необходимо получить API-ключ через панель автора.

### Как получить API-ключ

1. **Откройте Панель Автора**: Перейдите в свою панель автора Tribute
2. **Перейдите в Настройки**: Нажмите на три точки (⋯) в меню
3. **Откройте раздел API-ключи**: Выберите пункт "API Keys" в меню настроек
4. **Создайте новый ключ**: Нажмите кнопку "Generate API Key"
5. **Скопируйте и сохраните**: Скопируйте сгенерированный ключ и сохраните его в безопасном месте

### Использование API-ключа

API-ключ передаётся в заголовке `Api-Key` в каждом HTTPS-запросе к API.

#### Пример с использованием curl:

```bash
curl -X GET \
  'https://tribute.tg/api/v1/products' \
  -H 'Api-Key: your_api_key_here'
```

# API документация

## Авторизация

Для доступа к API Tribute необходимо получить API-ключ через панель автора.

### Как получить API-ключ

1. **Откройте Панель Автора**: Перейдите в свою панель автора Tribute
2. **Перейдите в Настройки**: Нажмите на три точки (⋯) в меню
3. **Откройте раздел API-ключи**: Выберите пункт "API Keys" в меню настроек
4. **Создайте новый ключ**: Нажмите кнопку "Generate API Key"
5. **Скопируйте и сохраните**: Скопируйте сгенерированный ключ и сохраните его в безопасном месте

### Использование API-ключа

API-ключ передаётся в заголовке `Api-Key` в каждом HTTPS-запросе к API.

#### Пример с использованием curl:

```bash
curl -X GET \
  'https://tribute.tg/api/v1/products' \
  -H 'Api-Key: your_api_key_here'
```
